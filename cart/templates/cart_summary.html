{% extends 'base.html' %}

        {% include 'navbar.html' %}

        {% block content %}

        <div class="overflow-auto">
          <!-- Header-->
          <header class="bg-dark py-5">
              <div class="container px-4 px-lg-5 my-5">
                  <div class="text-center text-white">
                      <h1 class="display-4 fw-bolder">Shopping Cart</h1>
                      <p class="lead fw-normal text-white-50 mb-0">View Your Cart...</p>
                  </div>
              </div>
          </header>
          <br><br>
        </div>

        <div class="container">
          {% if cart_products %}
          <div class="row">
            <div class="col-lg-8">
              {% for product in cart_products %}
        <div class="card mb-3">
            <div class="row g-0">
              <div class="col-md-4">
                <img src="{{ product.image.url }}" class="img-fluid rounded-start" alt="{{ product }}">
              </div>
              <div class="col-md-8">
                <div class="card-body">
                  <h5 class="card-title">{{ product }}</h5>
                  <p class="card-text">{{ product.description }}</p>
                  <button type="button" class="btn btn-warning">{{ product.price }}$</button>
                  {% for key, value in quantities.items %}
                  {% if key == product.id|slugify %}
                  <button type="button" class="btn btn-light">Quantity: 
                    <input type="number" id="updated_qty{{ product.id }}" value="{{ value }}" maxlength="1" size="1">                      
                  </button>
                  {% endif %}
                  {% endfor %}
                  <button type="button" data-index="{{ product.id }}" class="btn btn-success update-cart"><i class="fa fa-edit"></i> Update</button>
                  <button type="button" data-index="{{ product.id }}" class="btn btn-danger delete-cart"><i class="fa fa-trash" aria-hidden="true"></i> Remove</button>
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
            </div>
            <div class="col-lg-4">
              <div class="container my-5">
                <div class="card p-4 shadow-sm">
                    <h4 class="fw-bold">Cart totals</h4>
                    <table class="table">
                        <tbody>
                            <tr>
                                <td>Subtotal</td>
                                <td class="text-end">$ {{ totals }}</td>
                            </tr>
                            <tr>
                              <td>Shipping</td>
                              <td class="text-end">£1,469.95</td>
                          </tr>
                            <tr>
                                <td>Total</td>
                                <td class="text-end fw-bold">£1,469.95</td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="d-grid">
                      <a href="{% url 'checkout' %}" class="btn btn-dark btn-lg">
                        PROCEED TO CHECKOUT
                      </a>
                    </div>
                </div>
              </div>
            </div>
          </div>
          {% else %}
          <div class="container d-flex"></div>
            <div class="row justify-content-center align-self-center w-100 text-center">
            <div class="col-12">
                <!-- Placeholder for an image or SVG similar to the one in your screenshot -->
                <div class="rounded-circle bg-light p-4 d-inline-block">
                    <i class="fa fa-shopping-cart fa-5x" aria-hidden="true"></i>
                </div>
                <h2 class="mt-3">Your cart is empty</h2>
                <p class="text-muted">Looks like you have not added anything to your cart. Go ahead & explore top categories.</p>
                <a href="{% url 'home' %}">
                    <button type="button" class="btn btn-primary">Return to Shop</button>
                </a>
            </div>
            </div>
        </div>
          {% endif %}
        </div><br><br>
        
        <script>
          //Update Cart
            $(document).on('click', '.update-cart', function(e){
            e.preventDefault();
            //grab the product id
            var productid = $(this).data('index');
            $.ajax({
              type:'POST',
              url: "{% url 'cart_update' %}",
              data: {
                product_id: $(this).data('index'),
                product_qty: $('#updated_qty'+productid).val(),
                csrfmiddlewaretoken: '{{ csrf_token }}',
                action: 'post',
              },
              success: function(json){
               //console.log(json)
                //document.getElementById('cart_quantity').textContent = json.qty
                location.reload();
              },
              error: function(xhr, errmsg, err){

              }
              });
            })

            //Delete Cart Items
            $(document).on('click', '.delete-cart', function(e){
            e.preventDefault();
            //grab the product id
            //var productid = $(this).data('index');
            $.ajax({
              type:'POST',
              url: "{% url 'cart_delete' %}",
              data: {
                product_id: $(this).data('index'),
                csrfmiddlewaretoken: '{{ csrf_token }}',
                action: 'post',
              },
              success: function(json){
               //console.log(json)
                //document.getElementById('cart_quantity').textContent = json.qty
                location.reload();
              },
              error: function(xhr, errmsg, err){

              }
              });
            })

        </script>
        {% endblock %}